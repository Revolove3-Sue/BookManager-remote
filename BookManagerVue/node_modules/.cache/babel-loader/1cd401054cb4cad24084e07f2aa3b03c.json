{"remainingRequest":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\BookManager\\src\\BookManagerVue\\node_modules\\babel-loader\\lib\\index.js!D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\BookManager\\src\\BookManagerVue\\src\\permission.js","dependencies":[{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\BookManager\\src\\BookManagerVue\\src\\permission.js","mtime":1720253388167},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\BookManager\\src\\BookManagerVue\\babel.config.js","mtime":1713778487112},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\BookManager\\src\\BookManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1713778493034},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\BookManager\\src\\BookManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1713778491283}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiRDovV29yay9Xb3JrU3BhY2UvR2l0V29ya1NwYWNlL1RlblNob3AvcmVzb3VyY2UvQm9va01hbmFnZXIvc3JjL0Jvb2tNYW5hZ2VyVnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9yZWdlbmVyYXRvclJ1bnRpbWUuanMiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICJEOi9Xb3JrL1dvcmtTcGFjZS9HaXRXb3JrU3BhY2UvVGVuU2hvcC9yZXNvdXJjZS9Cb29rTWFuYWdlci9zcmMvQm9va01hbmFnZXJWdWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIuanMiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRDovV29yay9Xb3JrU3BhY2UvR2l0V29ya1NwYWNlL1RlblNob3AvcmVzb3VyY2UvQm9va01hbmFnZXIvc3JjL0Jvb2tNYW5hZ2VyVnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKLyoNCiAqIEBEZXNjcmlwdGlvbjogDQogKiBAQXV0aG9yOiANCiAqIEBEYXRlOiAyMDI0LTAyLTIxIDE4OjEzOjIxDQogKi8KaW1wb3J0IHJvdXRlciBmcm9tICcuL3JvdXRlcic7CmltcG9ydCBzdG9yZSBmcm9tICcuL3N0b3JlJzsKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gJ2VsZW1lbnQtdWknOwovLyBpbXBvcnQgIkAvYXBpL2luaXRpYWxpemUiCmltcG9ydCBOUHJvZ3Jlc3MgZnJvbSAnbnByb2dyZXNzJzsgLy8gcHJvZ3Jlc3MgYmFyCmltcG9ydCAnbnByb2dyZXNzL25wcm9ncmVzcy5jc3MnOyAvLyBwcm9ncmVzcyBiYXIgc3R5bGUKaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICdAL3V0aWxzL2F1dGgnOyAvLyBnZXQgdG9rZW4gZnJvbSBjb29raWUKaW1wb3J0IGdldFBhZ2VUaXRsZSBmcm9tICdAL3V0aWxzL2dldC1wYWdlLXRpdGxlJzsKTlByb2dyZXNzLmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOyAvLyBOUHJvZ3Jlc3MgQ29uZmlndXJhdGlvbgoKdmFyIHdoaXRlTGlzdCA9IFsnL2xvZ2luJywgJy9yZWdpc3RlciddOyAvLyDmsqHmnInph43lrprlkJHnmb3lkI3ljZUKCnJvdXRlci5iZWZvcmVFYWNoKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICB2YXIgaGFzVG9rZW4sIGhhc1JvbGVzLCBfeWllbGQkc3RvcmUkZGlzcGF0Y2gsIHJvbGVzLCBhY2Nlc3NSb3V0ZXM7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICAvLyBzdGFydCBwcm9ncmVzcyBiYXJ+CiAgICAgICAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKCiAgICAgICAgICAvLyBzZXQgcGFnZSB0aXRsZQogICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBnZXRQYWdlVGl0bGUodG8ubWV0YS50aXRsZSk7CgogICAgICAgICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHVzZXIgaGFzIGxvZ2dlZCBpbgogICAgICAgICAgaGFzVG9rZW4gPSBnZXRUb2tlbigpOwogICAgICAgICAgaWYgKCFoYXNUb2tlbikgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCEodG8ucGF0aCA9PT0gJy9sb2dpbicpKSB7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA5OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGlmIGlzIGxvZ2dlZCBpbiwgcmVkaXJlY3QgdG8gdGhlIGhvbWUgcGFnZQogICAgICAgICAgbmV4dCh7CiAgICAgICAgICAgIHBhdGg6ICcvJwogICAgICAgICAgfSk7CiAgICAgICAgICBOUHJvZ3Jlc3MuZG9uZSgpOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA5OgogICAgICAgICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHVzZXIgaGFzIG9idGFpbmVkIGhpcyBwZXJtaXNzaW9uIHJvbGVzIHRocm91Z2ggZ2V0SW5mbwogICAgICAgICAgaGFzUm9sZXMgPSBzdG9yZS5nZXR0ZXJzLnJvbGVzICYmIHN0b3JlLmdldHRlcnMucm9sZXMubGVuZ3RoID4gMDsKICAgICAgICAgIGlmICghaGFzUm9sZXMpIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzMzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTQ7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTc7CiAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goJ3VzZXIvZ2V0SW5mbycpOwogICAgICAgIGNhc2UgMTc6CiAgICAgICAgICBfeWllbGQkc3RvcmUkZGlzcGF0Y2ggPSBfY29udGV4dC5zZW50OwogICAgICAgICAgcm9sZXMgPSBfeWllbGQkc3RvcmUkZGlzcGF0Y2gucm9sZXM7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goJ3Blcm1pc3Npb24vZ2VuZXJhdGVSb3V0ZXMnLCByb2xlcyk7CiAgICAgICAgY2FzZSAyMToKICAgICAgICAgIGFjY2Vzc1JvdXRlcyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAvLyBkeW5hbWljYWxseSBhZGQgYWNjZXNzaWJsZSByb3V0ZXMKICAgICAgICAgIHJvdXRlci5hZGRSb3V0ZXMoYWNjZXNzUm91dGVzKTsKCiAgICAgICAgICAvLyBoYWNrIG1ldGhvZCB0byBlbnN1cmUgdGhhdCBhZGRSb3V0ZXMgaXMgY29tcGxldGUKICAgICAgICAgIC8vIHNldCB0aGUgcmVwbGFjZTogdHJ1ZSwgc28gdGhlIG5hdmlnYXRpb24gd2lsbCBub3QgbGVhdmUgYSBoaXN0b3J5IHJlY29yZAogICAgICAgICAgbmV4dChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRvKSwge30sIHsKICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICAgICAgfSkpOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNjoKICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNjsKICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMTQpOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMwOwogICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCd1c2VyL3Jlc2V0VG9rZW4nKTsKICAgICAgICBjYXNlIDMwOgogICAgICAgICAgTWVzc2FnZS5lcnJvcihfY29udGV4dC50MCB8fCAnSGFzIEVycm9yJyk7CiAgICAgICAgICBuZXh0KCIvbG9naW4/cmVkaXJlY3Q9Ii5jb25jYXQodG8ucGF0aCkpOwogICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICBjYXNlIDMzOgogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM2OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzNToKICAgICAgICAgIC8qIGhhcyBubyB0b2tlbiovCgogICAgICAgICAgaWYgKHdoaXRlTGlzdC5pbmRleE9mKHRvLnBhdGgpICE9PSAtMSkgewogICAgICAgICAgICAvLyBpbiB0aGUgZnJlZSBsb2dpbiB3aGl0ZWxpc3QsIGdvIGRpcmVjdGx5CiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG90aGVyIHBhZ2VzIHRoYXQgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBhY2Nlc3MgYXJlIHJlZGlyZWN0ZWQgdG8gdGhlIGxvZ2luIHBhZ2UuCiAgICAgICAgICAgIG5leHQoIi9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5wYXRoKSk7CiAgICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICAgICAgICB9CiAgICAgICAgY2FzZSAzNjoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgfQogICAgfSwgX2NhbGxlZSwgbnVsbCwgW1sxNCwgMjZdXSk7CiAgfSkpOwogIHJldHVybiBmdW5jdGlvbiAoX3gsIF94MiwgX3gzKSB7CiAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKSk7CnJvdXRlci5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIC8vIGZpbmlzaCBwcm9ncmVzcyBiYXIKICBOUHJvZ3Jlc3MuZG9uZSgpOwp9KTs="},{"version":3,"names":["router","store","Message","NProgress","getToken","getPageTitle","configure","showSpinner","whiteList","beforeEach","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","to","from","next","hasToken","hasRoles","_yield$store$dispatch","roles","accessRoutes","wrap","_callee$","_context","prev","start","document","title","meta","path","done","getters","length","dispatch","sent","addRoutes","_objectSpread","replace","t0","error","concat","indexOf","stop","_x","_x2","_x3","apply","arguments","afterEach"],"sources":["D:/Work/WorkSpace/GitWorkSpace/TenShop/resource/BookManager/src/BookManagerVue/src/permission.js"],"sourcesContent":["/*\r\n * @Description: \r\n * @Author: \r\n * @Date: 2024-02-21 18:13:21\r\n */\r\nimport router from './router'\r\nimport store from './store'\r\nimport { Message } from 'element-ui'\r\n// import \"@/api/initialize\"\r\nimport NProgress from 'nprogress' // progress bar\r\nimport 'nprogress/nprogress.css' // progress bar style\r\nimport { getToken } from '@/utils/auth' // get token from cookie\r\nimport getPageTitle from '@/utils/get-page-title'\r\n\r\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\r\n\r\nconst whiteList = ['/login', '/register'] // 没有重定向白名单\r\n\r\nrouter.beforeEach(async(to, from, next) => {\r\n  // start progress bar~\r\n  NProgress.start()\r\n\r\n  // set page title\r\n  document.title = getPageTitle(to.meta.title)\r\n\r\n  // determine whether the user has logged in\r\n  const hasToken = getToken()\r\n\r\n  if (hasToken) {\r\n    if (to.path === '/login') {\r\n      // if is logged in, redirect to the home page\r\n      next({ path: '/' })\r\n      NProgress.done()\r\n    } else {\r\n      // determine whether the user has obtained his permission roles through getInfo\r\n      const hasRoles = store.getters.roles && store.getters.roles.length > 0\r\n      if (hasRoles) {\r\n        next()\r\n      } else {\r\n        try {\r\n          // get user info\r\n          // note: roles must be a object array! such as: ['admin'] or ,['developer','editor']\r\n          const { roles } = await store.dispatch('user/getInfo')\r\n\r\n          // generate accessible routes map based on roles\r\n          const accessRoutes = await store.dispatch('permission/generateRoutes', roles)\r\n\r\n          // dynamically add accessible routes\r\n          router.addRoutes(accessRoutes)\r\n\r\n          // hack method to ensure that addRoutes is complete\r\n          // set the replace: true, so the navigation will not leave a history record\r\n          next({ ...to, replace: true })\r\n        } catch (error) {\r\n          // remove token and go to login page to re-login\r\n          await store.dispatch('user/resetToken')\r\n          Message.error(error || 'Has Error')\r\n          next(`/login?redirect=${to.path}`)\r\n          NProgress.done()\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    /* has no token*/\r\n\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      // in the free login whitelist, go directly\r\n      next()\r\n    } else {\r\n      // other pages that do not have permission to access are redirected to the login page.\r\n      next(`/login?redirect=${to.path}`)\r\n      NProgress.done()\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  // finish progress bar\r\n  NProgress.done()\r\n})\r\n"],"mappings":"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"}]}